<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="ja">
	<head>
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta http-equiv="Content-Type" content="text/html; charset=shift_jis">
		<meta http-equiv="Content-Script-Type" content="text/javascript">
		<meta name="format-detection" content="telephone=no">

		<title>お問い合わせフォーム</title>

		<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
        <style>
            #contact .modalOverlay{display:none;position:fixed;top:0;left:0;width:100%;height:100%;z-index:102;overflow:auto;background-color:rgba(0, 0, 0, 0.6);}
            #contact .modalWrap,#contact .modalWrap_error{display:none;position:fixed;top:0;left:0;z-index:103;width:100%;height:100%;}
            #contact .modalOuter,#contact .modalOuter_error{z-index:104;background-color:#fff;border-radius:8px;position:relative;margin:16px;padding-bottom:24px;}
            #contact .modal__headArea{padding:16px 24px;font-size:14px;font-weight:bold;text-align:center;}
            #contact .modal__bodyArea{margin-bottom:16px;padding:0 24px;overflow:auto;}
            #contact .modalOuter_error{top:27%;margin-top:-8%;}
            #contact .modalWrap_error .modal__bodyArea{font-size:1.6rem;text-align:center;}
            #contact .modal_error_btnArea{padding:0 16px;}
            #contact .modal_error_btnArea p:last-of-type{margin-top:16px;}
        </style>
	</head>
	
	<!-- cbdTemplate -->
	<template id="cbdTemplate">
		<div class="contbrd-cont">
			<div class="contbrd-head">
				<dl>
				<dt><span class="actor-text"></span><div class="outputNew list-qa-box"></div></dt>
				<dd class="createddate"></dd>
				</dl>
			</div>
			<div class="contbrd-body">
				<div id="" name="cbdId" class="contbrd-txt">
					<p class="contbrd-content"></p>
				</div>
			</div>
		</div>
	</template>
	<!-- cbdTemplate -->

	<!-- fileTemplate -->
	<template id="fileTemplate">
		<p><a class="fileLink"></a></p>
	</template>
	<!-- fileTemplate -->
	
	<body id="contact">
		
		<div>
			<a id="link"></a>
		</div>
		
		<div id="outputCbdTemp">					
		</div>
        <div class="modalOverlay"></div>

		<button onclick="responseApexData();">登録</button>
		
        
        <div class="modalWrap_error error-type2">
            <div class="modalOuter_error">
                <div class="modal__headArea"><img src="contact_error.png" alt="" width="128" height="64"></div>
                <div class="modal__bodyArea">
                    <p class="fBold">通信エラーが発生しました。<br>時間をおいて、再度お試しください。</p>
                </div><!--/modal__bodyArea-->
                <div class="modal_error_btnArea">
                    <p><a href="javascript:void(0);" class="btn btn03 btnL mClose">閉じる</a></p>
                </div><!--/modal_error_btnArea-->
            </div><!--/modalOuter_error-->
        </div><!--/modalWrap_error-->


		<script type="text/javascript">

		// 通信先URL　※環境に併せて変更する必要あり！
		const REQUEST_DOMAIN = 'https://paypay-bank--pt49.sandbox.my.salesforce.com';
		let res;
		$(function(){
			//responseApexData();

		});

        $(".mClose").on("click", function(){
            var CurrentScrollY = $(window).scrollTop();
            $(".modalOverlay,.modalWrap_error").fadeOut();
            $(".modalWrap_error").css("display", "none");
            $("body").css({position:"",top:0 * CurrentScrollY});
        });
        function dispalyComErrorModal(){
            let CurrentScrollY = $(window).scrollTop();
            $(".modalOverlay,.modalWrap_error.error-type1").fadeIn();
            $(".modalWrap_error").css("display", "block");
            $("body").css({position:"fixed",top:-1 * CurrentScrollY});
        }
		function responseApexData(){
			
            $.ajax({
                type: 'POST',
                crossOrigin: true,
                url: REQUEST_DOMAIN + '/services/oauth2/token',
                dataType: 'json',
                cache :false,
                data : {
                    "grant_type":"refresh_token",
                    "client_id":"3MVG99S6MzYiT5k.KkcZzmtcXubr_J8l8N8473VR.oFizQeVyWXFV5ARIiXmwhmXqjuNU.K6Pk9mc9M3btLBQ", 
                    //"refresh_token":"5Aep861hjC52juQoBcsFRsbEALR2k2PEkuCJTzezJjsxYDFcfM3Xu_8fN.OBDlZ6BJFv9GwwXc8hH5doNmlIiVu"
                    "refresh_token":"5Aep861hjC52juQoBcsFRsbEALR2k2PEkuCJTzezJjsxYDFcfM3Xu_8fN.OBDlZ6BJFv9GwwXc8hH5doNm"
                },
                success : function (connectData) {
                    var accToken = 'Bearer ' + connectData.access_token;
                    $.ajax({
                        type: 'GET',
                        crossOrigin: true,
                        url: REQUEST_DOMAIN + '/services/apexrest/IMF_Case',
                        dataType: 'json',
                        cache :false,
                        data: {inquiry : 'd5b8d90ceb5ff5f3505dd311e1e74f6e3f87d028ddac9c3c4c18ede46409'},
                        headers: {"Authorization" : accToken},
                        success : function (res) {
                            console.log('success');
                            console.log(res)
                        },
                        error : function (data, errorThrown,status) {
                            console.log('error');

                            dispalyComErrorModal();


                        }
                    })
                },
                error : function (data, errorThrown,status) {
                    console.log('a_error');
                    dispalyComErrorModal();
                }
            });
		}
		</script>
	</body>
</html>
