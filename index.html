<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="ja">
	<head>
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta http-equiv="Content-Type" content="text/html; charset=shift_jis">
		<meta http-equiv="Content-Script-Type" content="text/javascript">
		<meta name="format-detection" content="telephone=no">

		<title>お問い合わせフォーム</title>

		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
	</head>
	
	<body id="contact">
		
		<div>
			<a id="link"></a>
		</div>
		
		<div id="outputCbdTemp">					
		</div>
		
		<script type="text/javascript">

        const REQUEST_DOMAIN = 'https://paypay-bank--pt49.sandbox.my.salesforce.com';
        const fileId = '0680l000002Qm23AAC';
        const fileName = '△△ご参考図.png';

        $(function(){
        //function getContentVersion(fileId){
		
            $.ajax({
                type: 'POST',
                crossOrigin: true,
                url: REQUEST_DOMAIN + '/services/oauth2/token',
                dataType: 'json',
                cache :false,
                data : {
                    "grant_type":"refresh_token",
                    "client_id":"3MVG99S6MzYiT5k.KkcZzmtcXubr_J8l8N8473VR.oFizQeVyWXFV5ARIiXmwhmXqjuNU.K6Pk9mc9M3btLBQ", 
                    "refresh_token":"5Aep861hjC52juQoBcsFRsbEALR2k2PEkuCJTzezJjsxYDFcfM3Xu_8fN.OBDlZ6BJFv9GwwXc8hH5doNmlIiVu"
                },
                success : function (connectData) {
                    var accToken = 'Bearer ' + connectData.access_token;
                    $.ajax({
                        type: 'GET',
                        crossOrigin: true,
                        url: REQUEST_DOMAIN + '/services/data/v54.0/sobjects/ContentVersion/' + fileId + '/VersionData',
                        cache :false,
                        headers: {"Authorization" : accToken},
                        xhrFields : {responseType : 'blob'},
                        success : function (fileContent) {
                            console.log(JSON.stringify(fileContent))
                            let fileUrl = URL.createObjectURL(new Blob(
                                [fileContent],
                                {type: "application/octet-stream"}
                            ));
                            document.getElementById('link').href = fileUrl;
                            document.getElementById('link').download = fileName;
                            document.getElementById('link').innerHTML = fileName;

                            //return fileContent;
                        }
                    })
                },
                error : function (data, errorThrown,status) {
                    console.log(data);
                    console.log(errorThrown);
                    console.log(status);
                }
            });

            //return DummyVersionData["ID_" + fileId];
        }
	    


		</script>
	</body>
</html>
