<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="ja">
	<head>
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta http-equiv="Content-Type" content="text/html; charset=shift_jis">
		<meta http-equiv="Content-Script-Type" content="text/javascript">
		<meta name="format-detection" content="telephone=no">

		<title>お問い合わせフォーム</title>

		<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
	</head>
	
	<!-- cbdTemplate -->
	<template id="cbdTemplate">
		<div class="contbrd-cont">
			<div class="contbrd-head">
				<dl>
				<dt><span class="actor-text"></span><div class="outputNew list-qa-box"></div></dt>
				<dd class="createddate"></dd>
				</dl>
			</div>
			<div class="contbrd-body">
				<div id="" name="cbdId" class="contbrd-txt">
					<p class="contbrd-content"></p>
				</div>
			</div>
		</div>
	</template>
	<!-- cbdTemplate -->

	<!-- fileTemplate -->
	<template id="fileTemplate">
		<p><a class="fileLink"></a></p>
	</template>
	<!-- fileTemplate -->
	
	<body id="contact">
		
		<div>
			<a id="link"></a>
		</div>
		
		<div id="outputCbdTemp">					
		</div>
		<button onclick="responseApexData();">登録</button>
		
		<script type="text/javascript">

		// 通信先URL　※環境に併せて変更する必要あり！
		const REQUEST_DOMAIN = 'https://paypay-bank--pt49.sandbox.my.salesforce.com';
		let res;
		$(function(){
			responseApexData();
		});

		// POSTデータ
		let requestParam = JSON.stringify(
            {
				'eStr': 'd5b8d90ceb5ff5f3505dd311e1e74f6e3f87d028ddac9c3c4c18ede46409e0ef', 
				'subject': 'ajaxTest', 
				'content': 'contentTest小山01', 
				'linkedDial': 'キャッシュカード・トークン'
			}
		)

		function responseApexData(){
			
			// アクセストークン取得（リフレッシュトークンフロー） Ajax
			$.ajax({
				type: 'POST',
				crossOrigin: true,
				url: REQUEST_DOMAIN + '/services/oauth2/token',
				dataType: 'json',
				cache :false,
				data : {
					"grant_type":"refresh_token",
					"client_id":"3MVG99S6MzYiT5k.KkcZzmtcXubr_J8l8N8473VR.oFizQeVyWXFV5ARIiXmwhmXqjuNU.K6Pk9mc9M3btLBQ", 
					"refresh_token":"5Aep861hjC52juQoBcsFRsbEALR2k2PEkuCJTzezJjsxYDFcfM3Xu_8fN.OBDlZ6BJFv9GwwXc8hH5doNmlIiVu"
				},
				success : function (connectData) {
                    console.log(JSON.stringify(requestParam));
					var accToken = 'Bearer ' + connectData.access_token;
					$.ajax({
						type: 'POST',
						crossOrigin: true,
						url: REQUEST_DOMAIN + '/services/apexrest/IMF_Case',
						dataType: 'json',
						cache :false,
						data: requestParam,
						headers: {"Authorization" : accToken},
						success : function (res) {
							return res;
							console.log(res);
							console.log('success');
						},
						error : function (data, errorThrown,status) {
							
						}
					})
				},
				error : function (data, errorThrown,status) {
					console.log(data);
					console.log(errorThrown);
					console.log(status);
				}
			});
		}
		</script>
	</body>
</html>
